# Running Money World locally

To run the application, run `sencha web start` in this folder. You should be able to run the application at `localhost:1841` (depends on your Sencha Cmd configuration).

# Building Money World

To build the application, run `sencha app build` in this folder. Building the application is necessary to rebuild `bootstrap.js`; the only reason so far for that is to register custom stylesheets in `resources`.

# Structure

## Init

In `app.js`, the first view to be loaded is `Init`. It checks if the user has saved any settings on the machine. If the user is using the application for the first time `Settings` will be loaded, otherwise `Main` will be created and pushed to the viewport.

## Main (level 0)

The `Main` view is a Sencha Navigation View. It is essentially a stack of views, which can be pushed and popped. `Main` comprises:

* A navigation bar containing
	* A back button (which appears if the stack has more than one item)
	* A country mode button (which resets `Main` and show `Overview`)
	* A region mode button (which pushs `MapView` (level 1))
	* A settings button (which pushs `Settings` (level 1))
* `Overview` (level 1)

The `Main` controller specifies the behaviour of the buttons of the navigation bar.

## Overview (level 1)

The `Overview` view is a Sencha Carousel which contains all the `SummaryView_` (level 2) views. A tap listener is registered with the `Overview` view (not the inner `SummaryView_` views) to push the respective `DetailedView` (level 1) view on the stack.

## SummaryView and SummaryView_ (level 2)

`SummaryView` is an abstract view from which all `SummaryView_` views must extend.

`SummaryView_` are the actual views. The view must contain the parameters `dataSet` and `dataSetInternal`.

As level 2 views, `SummaryView_` views are "required" by the `Overview` (level 1) view.

## DetailedView and DetailedView_ (level 1)

`DetailedView` is an abstract view from which all `DetailedView_` views must extend.

`DetailedView_` are the actual views. The view does not need to contain any parameters.

As level 1 views, `DetailedView_` views are "required" by the `Main` (level 0) view.

# Implementing a new indicator X

* Create `./app/view/SummaryViewX.js` extending view `SummaryView` with `xtype: summaryview_x`
	* `SummaryViewX` must have the `dataSet` and `dataSetInternal` fields
* Create `./app/view/DetailedViewX.js` extending view `DetailedView` with `xtype: detailedview_x`
* Create `./app/controller/SummaryViewX.js` extending controller `SummaryView` with no `xtype`
	* `SummaryViewX` must have the `renderView` function that is called upon `initialize`
* Create `./app/controller/DetailedViewX.js` extending controller `DetailedView` with no `xtype`
	* `DetailedViewX` must have the `renderView` function that is called upon `initialize`
* Register `SummaryViewX` views in the `Overview` view
* Register `DetailedViewX` views in the `Main` view
* Register the new controllers in `app.js`

# Naming conventions

Consider the "unemployment" indicator, which we find in the `../database/datasets.csv` file to have the code `SL.UEM.TOTL.ZS`. For convenience, we'll call this indicator "unemp".

The `dataSet` of this indicator is thus `SL.UEM.TOTAL.ZS` and the `dataSetInternal` is `Unemp`. `dataSetInternal` is actually the `X` used in the instructions above, hence we'll have `SummaryViewUnemp.js` and `DetailedViewUnemp.js`.

The `xtype`s will be `summaryview_x` and `detailedview_x` where `x` is the lowercase representation of `X` i.e. `unemp`. In this example, the `xtypes` will be `summaryview_unemp` and `detailedview_unemp`.

HTML ids and classes of elements in the views must be named as `summaryview_unemp-container-list` or `detailedview_lifeexpectancy-legend` to prevent conflicts. Do not give a generic id or class which may result in problems.

Stylesheets for `summaryview_x` and `detailedview_x` views are stored in `./resources/css/` as `summaryview_x.css` and `detailedview_x.css`. Stylesheets must be explicitly registered in `app.json`, after which `bootstrap.js` (not in the repository, but on your local machine) must be generated by running `sencha app build`. Even if `sencha app build` fails because of some dependencies, in most cases `bootstrap.js` would still be successfully regenerated during the process.

# Contents

## ./app.js

This is the file to register all controllers and top-level views only.

* Registration of SummaryView views: `./app/view/Overview.js`
* Registration of DetailedView views: `.app/view/Main.js`
* Registation of MapView subviews: `./app/view/Main.js`

## ./app.json

Custom resources and stylesheets are registered here.

## ./app

This folder contains the actual application files.

## ./data

This folder contains the JSON data files required.

## ./resources

This folder contains all the resources: images, external JavaScript libraries, stylesheets etc.
