Ext.define('moneyworld.controller.MapView', {
	extend: 'Ext.app.Controller',

	config: {
		refs: {
			mainView: 'main',
			mapView: 'mapview'
		},
		control: {
			'mapView': {
				activate: 'loadTitle'
			}
		}
	},

	loadTitle: function() {
		var settingsStore = Ext.getStore('Settings');
		var countriesStore = Ext.getStore('Countries');
		var country = settingsStore.getAt(0).get('country');
		var regionName = countriesStore.findRecord('code2', country).get('region');

		var innerItems = this.getMainView().getInnerItems();
		for ( var i = 0; i < innerItems.length; i++ ) {
			if ( innerItems[i] === this.getMapView() ) {
				break;
			}
		}

		this.getMapView().setTitle(regionName);
		this.getMainView().getNavigationBar().backButtonStack[i] = regionName;
		this.getMainView().getNavigationBar().setTitle(regionName);
	},
});
