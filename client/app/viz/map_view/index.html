<!DOCTYPE html>
<html>

<head>
    <title>
        Map view
    </title>
    <link rel="stylesheet" media="all" href="jquery-jvectormap.css">
    <link rel="stylesheet" media="all" href="themes/base/jquery.ui.all.css">
    <script src="assets/jquery-latest.js"></script>
    <script src="jquery-jvectormap.js"></script>
    <script src="jquery-mousewheel.js"></script>
    <script src="jquery.jvectormap.min.js"></script>

    <script src="assets/jquery.vmap.africa.js"></script>
    <script src="assets/gdp_sample_by_region.js"></script>
    <script src="assets/population_2000_all.js"></script>
    <script src="assets/jquery.ui.widget.js"></script>
    <script src="assets/jquery.ui.core.js"></script>
    <script src="assets/jquery.ui.mouse.js"></script>
    <script src="assets/jquery.ui.slider.js"></script>
    <script src="libraries.js"></script>

    <link href='font.css' rel='stylesheet' type='text/css'>

</head>

<body>
    <div id="wrapper">
        <div id="map1"></div>
        <div id='slider-container'>
            <div class="adjust-year-button left">
                <span>Prev</span>
            </div>
            <div id='slider-with-label'>
                <div id="slider" style="margin:10px;"></div>
                <div id="yearLabel" style="width: 96%">
                    <span class="left-float-text"></span>
                    <span class="right-float-text"></span>
                </div>
            </div>
            <div class="adjust-year-button right">
                <span>Next</span>
            </div>
        </div>
    </div>

    <script>
    //global var
    var current_map_id;
    var min_scroller = 2000;
    var max_scroller = 2013;
    var map;
    var $ = jQuery;
    var direction = 0; // default higher value is green
    jQuery(document).ready(function() {
        // get data from localstorage if available
        if (localStorage['moneyworld'] != undefined) {
            sample2 = JSON.parse(localStorage['moneyworld']);
        }
        if (localStorage['direction'] != undefined) {
            direction = JSON.parse(localStorage['moneyworld']);
        }
        generateMap('africa_en', sample2['2000'], direction);
    });
    var sliderObj = $("#slider").slider({
        value: min_scroller,
        min: min_scroller,
        max: max_scroller,
        step: 1,
        slide: function(event, ui) {
            val = ui.value;
            generateMap(current_map_id, sample2[ui.value], direction);
        }
    });

    //bind left and right key to change slider
    $('.adjust-year-button.right').click(function() {
        sliderObj.slider('value', sliderObj.slider('value') + sliderObj.slider("option", "step"));
        //TODO: change this hacker way
        generateMap(current_map_id, sample2[sliderObj.slider('value')], direction);

    });
    $('.adjust-year-button.left').click(function() {
        sliderObj.slider('value', sliderObj.slider('value') - sliderObj.slider("option", "step"));
        //TODO: change this hacker way
        generateMap(current_map_id, sample2[sliderObj.slider('value')], direction);

    });

    // update left and right values

    $(".left-float-text").text(min_scroller);
    $(".right-float-text").text(max_scroller);

    // update map object

    function updateMap() {
        map = $('#map1').vectorMap('get', 'mapObject');
    }

    // Making key

    function makekey() {
        var key = $("#key");
        updateMap();
        key.toggleClass("invisible");
        key.empty();
        var localMin = map.series.regions[0].scale.clearMinValue;
        var localMax = map.series.regions[0].scale.clearMaxValue;
        var steps = 4;
        for (var i = 0; i <= steps; i++) {
            var jumps = (localMax - localMin) / steps;
            var val = localMin + jumps * i;
            var color = map.series.regions[0].scale.getValue(val);
            if (i == 0) {
                key.append('<div style="background-color:' + color + ';"> < ' + val.toFixed(2) + '</div>');
            } else if (i == steps) {
                key.append('<div style="background-color:' + color + ';">' + val.toFixed(2) + ' - ' + (val+ jumps).toFixed(2) + '%</div>');
            } else {
                key.append('<div style="background-color:' + color + ';"> < ' + val.toFixed(2) + '</div>');
            }
        }
    }
    </script>
</body>

</html>
